package com.eaglesandcobras.common.sounds {	import flash.events.EventDispatcher;	import flash.events.Event;	import com.eaglesandcobras.common.sounds.SoundManager;	import com.eaglesandcobras.common.util.math.Random;	import flash.net.URLLoader;	import flash.net.URLRequest;		public class XMLSoundLoop extends EventDispatcher {		private var _path:String;		private var _sm:SoundManager;		private var _l:URLLoader;		private var _songs:Array;		private var _xml:XMLList;		private var _random:Boolean;		private var _randomOrder:Boolean;		private var _randomVar:int;		private var _current:int;		private var _total:int;		private var _randomArray:Array;				public function XMLSoundLoop():void {			_sm = SoundManager.getInstance();			_sm.addEventListener ( Event.COMPLETE, nextSound );		}				public function load($path:String, $randomStart:Boolean = false, $randomOrder:Boolean = false, $current:int=0):void {			_path = $path;			_random = $randomStart;			_randomOrder = $randomOrder;			_current = $current;						_l=new URLLoader();			_l.load( new URLRequest ( _path) );			_l.addEventListener(Event.COMPLETE, xmlLoaded);		}				private function xmlLoaded(e:Event):void {			_songs = new Array(); 						_xml = new XML(e.target.data).item;						_total = _xml.length();						// add Songs			for (var i=0;i<_total;i++) {				var p:String = _xml[i];				var n:String = "track"+i;								_sm.addExternalSound ( p,n );								_songs.push ( n );			}						//GET THE FIRST SONG			getFirstSongNumber();			//PLAY THE FIRST SONG			playSong(_current);		}				private function getFirstSongNumber():void {			if (_randomOrder) {				_randomVar = 0;				_randomArray = Random.sequence( _xml.length() );				_current = _randomArray[_randomVar];			} else {				if (_random) _current = ( Math.floor ( Math.random() * _xml.length() ) );			}		}				private function playSong (id:Number):void {			_sm.playSound ( _songs[id] );		}				private function nextSound(e:Event):void {			if (_randomOrder) {				_randomVar++;				if (_randomVar==_randomArray.length) _randomVar=0;				_current = _randomArray[_randomVar];			} else {				_current++;				if (_current==_total) _current=0;			}			playSong(_current);		}	}}